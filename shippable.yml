language: go

go:
  - 1.8

build:
  ci:
    - which go
    - echo $GOROOT
    - echo $GOPATH
    - ls
    - pwd
    - make init
    - go get github.com/tools/godep
    - godep restore
    - make test-formatters
    - make test-contracts
    # Check if any error is not being handled
    - go get -u github.com/kisielk/errcheck
    - errcheck ./...
    # Build binary and worker
    - docker build -t "scriptnull/badgeit-worker:$BRANCH.$BUILD_NUMBER" .
    - docker images
    - docker push scriptnull/badgeit-worker:$BRANCH.$BUILD_NUMBER
    # Build api
    - docker build -t "scriptnull/badgeit-api:$BRANCH.$BUILD_NUMBER" ./api/.
    - docker images
    - docker push scriptnull/badgeit-api:$BRANCH.$BUILD_NUMBER


integrations:
  hub:
    - integrationName: Vishnu's Docker
      type: docker
      branches:
        only:
          - master
          - dev